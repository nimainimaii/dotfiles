#!/bin/sh

# To add new themes,
# add gtk theme to $HOME/.local/share/themes
# install neovim theme and add it to theme setting function
# add xresources file to $HOME/.config/X11

THEMES="gruvbox_dark
gruvbox_light
dracula"

if [ -n "$*" ]
then
	CHOOSEN_THEME="$*"
else
	CHOOSEN_THEME=$(echo "$THEMES" | dmenu)
fi

if echo "$THEMES" | grep -q "^${CHOOSEN_THEME}$"
then
	xrdb "${XDG_CONFIG_HOME}/X11/${CHOOSEN_THEME}"

	xrdb -merge "${XDG_CONFIG_HOME}/X11/common"

	kill -s USR1 $(pidof st) &

	xdotool key "Super+F12" &

	nvimcmd ":lua SetColorScheme('${CHOOSEN_THEME}')" &

	sed -i "s/^Net\/ThemeName \".*\"/Net\/ThemeName \"${CHOOSEN_THEME}\"/g" "$XDG_CONFIG_HOME/xsettingsd/xsettingsd.conf" && killall xsettingsd ; xsettingsd &

	sed -i "s/^SetColorScheme(.*)/SetColorScheme('${CHOOSEN_THEME}')/g" "$XDG_CONFIG_HOME/nvim/lua/nimai/theme.lua"
else
	exit 1
fi
